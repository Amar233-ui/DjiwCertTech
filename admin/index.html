<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DjiwCertTech - Administration</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar" style="display: none;">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-seedling"></i>
                <span>DjiwCertTech</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" data-page="dashboard">
                <i class="fas fa-chart-line"></i>
                <span>Tableau de bord</span>
            </a>
            <a href="#vendors" class="nav-item" data-page="vendors">
                <i class="fas fa-store"></i>
                <span>Vérification Vendeurs</span>
            </a>
            <a href="#stock" class="nav-item" data-page="stock">
                <i class="fas fa-boxes"></i>
                <span>Gestion Stock</span>
            </a>
            <a href="#subsidies" class="nav-item" data-page="subsidies">
                <i class="fas fa-hand-holding-usd"></i>
                <span>Subventions</span>
            </a>
            <a href="#weather" class="nav-item" data-page="weather">
                <i class="fas fa-cloud-sun-rain"></i>
                <span>Risques Climatiques</span>
            </a>
            <a href="#logistics" class="nav-item" data-page="logistics">
                <i class="fas fa-truck"></i>
                <span>Logistique</span>
            </a>
            <a href="#training" class="nav-item" data-page="training">
                <i class="fas fa-graduation-cap"></i>
                <span>Formations</span>
            </a>
            <a href="#statistics" class="nav-item" data-page="statistics">
                <i class="fas fa-chart-bar"></i>
                <span>Statistiques</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                    <span class="user-name" id="userName">Admin</span>
                    <span class="user-role">Administrateur</span>
                </div>
            </div>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </button>
        </div>
    </aside>

    <!-- Login Page (outside mainContent) -->
    <div id="loginPage" class="login-page-wrapper" style="display: flex;">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <i class="fas fa-seedling"></i>
                    <h1>DjiwCertTech</h1>
                    <p>Panneau d'administration</p>
                </div>
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label for="adminEmail">Email</label>
                        <input type="email" id="adminEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Mot de passe</label>
                        <input type="password" id="adminPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-sign-in-alt"></i>
                        Se connecter
                    </button>
                    <div id="loginError" class="error-message"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content" id="mainContent" style="display: none;">
        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-chart-line"></i> Tableau de bord</h1>
                <div class="page-actions">
                    <button class="btn btn-secondary" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i> Actualiser
                    </button>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalUsers">0</h3>
                        <p>Utilisateurs</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalVendors">0</h3>
                        <p>Vendeurs</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalOrders">0</h3>
                        <p>Commandes</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalProducts">0</h3>
                        <p>Produits</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h2>Commandes récentes</h2>
                    <div id="recentOrders" class="table-container"></div>
                </div>
                <div class="dashboard-card">
                    <h2>Vendeurs en attente</h2>
                    <div id="pendingVendors" class="table-container"></div>
                </div>
            </div>
        </div>

        <!-- Vendors Page -->
        <div id="vendorsPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-store"></i> Vérification des Vendeurs</h1>
                <div class="page-actions">
                    <input type="text" id="vendorSearch" class="search-input" placeholder="Rechercher un vendeur...">
                </div>
            </div>
            
            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">Tous</button>
                <button class="filter-tab" data-filter="pending">En attente</button>
                <button class="filter-tab" data-filter="approved">Approuvés</button>
                <button class="filter-tab" data-filter="rejected">Rejetés</button>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Email</th>
                            <th>Téléphone</th>
                            <th>Statut</th>
                            <th>Date d'inscription</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="vendorsTableBody">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Stock Page -->
        <div id="stockPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-boxes"></i> Gestion du Stock Global</h1>
                <div class="page-actions">
                    <button class="btn btn-primary" onclick="openAddProductModal()">
                        <i class="fas fa-plus"></i> Ajouter un produit
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Produit</th>
                            <th>Catégorie</th>
                            <th>Zone</th>
                            <th>Stock</th>
                            <th>Prix</th>
                            <th>Certification</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="stockTableBody">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Subsidies Page -->
        <div id="subsidiesPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-hand-holding-usd"></i> Gestion des Subventions</h1>
                <div class="page-actions">
                    <button class="btn btn-primary" onclick="openAddSubsidyModal()">
                        <i class="fas fa-plus"></i> Nouvelle subvention
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Type</th>
                            <th>Montant</th>
                            <th>Bénéficiaires</th>
                            <th>Date début</th>
                            <th>Date fin</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="subsidiesTableBody">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Weather Page -->
        <div id="weatherPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-cloud-sun-rain"></i> Analyse des Risques Climatiques</h1>
            </div>

            <div class="weather-alerts-container" id="weatherAlerts">
                <!-- Rempli dynamiquement -->
            </div>
        </div>

        <!-- Logistics Page -->
        <div id="logisticsPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-truck"></i> Supervision de la Logistique</h1>
            </div>

            <div class="logistics-grid">
                <div class="logistics-card">
                    <h2>Commandes en cours</h2>
                    <div id="activeOrders" class="table-container"></div>
                </div>
                <div class="logistics-card">
                    <h2>Statistiques de livraison</h2>
                    <div id="deliveryStats" class="stats-list"></div>
                </div>
            </div>
        </div>

        <!-- Training Page -->
        <div id="trainingPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-graduation-cap"></i> Contrôle des Contenus de Formation</h1>
                <div class="page-actions">
                    <button class="btn btn-primary" onclick="openAddTrainingModal()">
                        <i class="fas fa-plus"></i> Nouvelle formation
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Titre</th>
                            <th>Catégorie</th>
                            <th>Durée</th>
                            <th>Statut</th>
                            <th>Date création</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="trainingTableBody">
                        <!-- Rempli dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Statistics Page -->
        <div id="statisticsPage" class="page">
            <div class="page-header">
                <h1><i class="fas fa-chart-bar"></i> Statistiques</h1>
                <div class="page-actions">
                    <select id="statsPeriod" class="select-input">
                        <option value="week">Semaine</option>
                        <option value="month" selected>Mois</option>
                        <option value="year">Année</option>
                    </select>
                </div>
            </div>

            <div class="stats-charts-grid">
                <div class="chart-card">
                    <h2>Ventes par zone</h2>
                    <canvas id="salesByZoneChart"></canvas>
                </div>
                <div class="chart-card">
                    <h2>Pics de demande</h2>
                    <canvas id="demandPeaksChart"></canvas>
                </div>
                <div class="chart-card">
                    <h2>Produits les plus vendus</h2>
                    <canvas id="topProductsChart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Vendor Modal -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal" id="vendorModal">
            <div class="modal-header">
                <h2>Détails du Vendeur</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="vendorModalBody">
                <!-- Rempli dynamiquement -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Annuler</button>
                <button class="btn btn-danger" id="rejectVendorBtn">Rejeter</button>
                <button class="btn btn-success" id="approveVendorBtn">Approuver</button>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModalOverlay" class="modal-overlay">
        <div class="modal" id="productModal" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="productModalTitle">Ajouter un produit</h2>
                <button class="modal-close" onclick="closeProductModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productForm" onsubmit="saveProduct(event)">
                    <div class="form-group">
                        <label for="productName">Nom du produit *</label>
                        <input type="text" id="productName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="productDescription">Description courte *</label>
                        <textarea id="productDescription" rows="2" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="productDetailedDescription">Description détaillée / Caractéristiques</label>
                        <textarea id="productDetailedDescription" rows="4"></textarea>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="productCategory">Catégorie *</label>
                            <select id="productCategory" required>
                                <option value="">Sélectionner...</option>
                                <option value="Semences">Semences</option>
                                <option value="Engrais">Engrais</option>
                                <option value="Outils">Outils</option>
                                <option value="Protection">Protection</option>
                                <option value="Irrigation">Irrigation</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="productZone">Zone géographique</label>
                            <select id="productZone">
                                <option value="">Toutes les zones</option>
                                <option value="Centre-Nord">Centre-Nord</option>
                                <option value="Nord">Nord</option>
                                <option value="Sahel">Sahel</option>
                                <option value="Est">Est</option>
                                <option value="Ouest">Ouest</option>
                                <option value="Sud">Sud</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="productPrice">Prix normal (FCFA) *</label>
                            <input type="number" id="productPrice" min="0" step="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="productDeferredPrice">Prix paiement différé (FCFA)</label>
                            <input type="number" id="productDeferredPrice" min="0" step="1">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="productStock">Stock *</label>
                            <input type="number" id="productStock" min="0" step="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="productCertification">Certification</label>
                            <input type="text" id="productCertification" placeholder="Ex: Certifié ISRA">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="productRating">Évaluation (0-5)</label>
                            <input type="number" id="productRating" min="0" max="5" step="0.1" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="productReviewCount">Nombre d'avis</label>
                            <input type="number" id="productReviewCount" min="0" step="1" value="0">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="productImage">Image du produit</label>
                        <input type="file" id="productImage" accept="image/*">
                        <div id="productImagePreview" style="margin-top: 10px; display: none;">
                            <img id="productImagePreviewImg" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid #E0E0E0;">
                        </div>
                    </div>
                    
                    <hr style="margin: 20px 0; border: none; border-top: 2px solid #E0E0E0;">
                    <h3 style="margin-bottom: 15px; color: var(--primary-green);">Traçabilité</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="productOrigin">Origine des semences</label>
                            <input type="text" id="productOrigin" placeholder="Ex: Centre de recherche ISRA">
                        </div>
                        
                        <div class="form-group">
                            <label for="productCertificationNumber">Numéro de certification</label>
                            <input type="text" id="productCertificationNumber" placeholder="Ex: CERT-2024-001">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="productProducerId">ID Producteur</label>
                            <input type="text" id="productProducerId" placeholder="ID du vendeur certifié">
                        </div>
                        
                        <div class="form-group">
                            <label for="productProducerName">Nom du producteur</label>
                            <input type="text" id="productProducerName" placeholder="Nom du producteur">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="productPackagingDate">Date de conditionnement</label>
                            <input type="date" id="productPackagingDate">
                        </div>
                        
                        <div class="form-group">
                            <label for="productPackagingLocation">Lieu de conditionnement</label>
                            <input type="text" id="productPackagingLocation" placeholder="Ex: Dakar, Sénégal">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="productSeason">Saison</label>
                            <select id="productSeason">
                                <option value="">Sélectionner...</option>
                                <option value="Hivernage (Juin-Octobre)">Hivernage (Juin-Octobre)</option>
                                <option value="Saison sèche (Novembre-Mai)">Saison sèche (Novembre-Mai)</option>
                                <option value="Toute l'année">Toute l'année</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="productAgroZone">Zone agro-écologique</label>
                            <select id="productAgroZone">
                                <option value="">Sélectionner...</option>
                                <option value="Zone Nord (Sahélienne)">Zone Nord (Sahélienne)</option>
                                <option value="Zone Centre (Soudano-Sahélienne)">Zone Centre (Soudano-Sahélienne)</option>
                                <option value="Zone Sud (Soudanienne)">Zone Sud (Soudanienne)</option>
                                <option value="Zone Casamance (Guinéenne)">Zone Casamance (Guinéenne)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="productIsForestSeed">
                            Semence forestière
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="productIsAvailable" checked>
                            Produit disponible
                        </label>
                    </div>
                    
                    <input type="hidden" id="productId">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeProductModal()">Annuler</button>
                <button class="btn btn-primary" onclick="document.getElementById('productForm').requestSubmit()">
                    <i class="fas fa-save"></i> Enregistrer
                </button>
            </div>
        </div>
    </div>

    <!-- Training Modal -->
    <div id="trainingModalOverlay" class="modal-overlay" style="display: none;">
        <div class="modal" id="trainingModal" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="trainingModalTitle">Ajouter une formation</h2>
                <button class="modal-close" onclick="closeTrainingModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="trainingForm">
                    <div class="form-group">
                        <label for="trainingTitle">Titre *</label>
                        <input type="text" id="trainingTitle" required placeholder="Ex: Techniques de plantation du mil">
                    </div>
                    
                    <div class="form-group">
                        <label for="trainingDescription">Description courte *</label>
                        <textarea id="trainingDescription" rows="3" required placeholder="Description de la formation"></textarea>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="trainingCategory">Catégorie *</label>
                            <select id="trainingCategory" required>
                                <option value="">Sélectionner...</option>
                                <option value="Culture">Culture</option>
                                <option value="Elevage">Elevage</option>
                                <option value="Equipement">Equipement</option>
                                <option value="Business">Business</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="trainingDuration">Durée (minutes) *</label>
                            <input type="number" id="trainingDuration" min="1" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="trainingContent">Contenu détaillé *</label>
                        <textarea id="trainingContent" rows="10" required placeholder="Contenu complet de la formation"></textarea>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="trainingVideoUrl">URL Vidéo (optionnel)</label>
                            <input type="url" id="trainingVideoUrl" placeholder="https://...">
                        </div>
                        
                        <div class="form-group">
                            <label for="trainingAudioUrl">URL Audio (optionnel)</label>
                            <input type="url" id="trainingAudioUrl" placeholder="https://...">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="trainingImageUrl">URL Image (optionnel)</label>
                        <input type="url" id="trainingImageUrl" placeholder="https://...">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="trainingIsDownloadable">
                                Téléchargeable
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="trainingIsPublished" checked>
                                Publiée
                            </label>
                        </div>
                    </div>
                    
                    <input type="hidden" id="trainingId">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTrainingModal()">Annuler</button>
                <button class="btn btn-primary" onclick="saveTraining(event)">
                    <i class="fas fa-save"></i> Enregistrer
                </button>
            </div>
        </div>
    </div>

    <!-- Users Management Page -->
    <div id="usersPage" class="page" style="display: none;">
        <div class="page-header">
            <h1><i class="fas fa-users"></i> Gestion des Utilisateurs</h1>
            <div class="page-actions">
                <input type="text" id="userSearch" class="search-input" placeholder="Rechercher un utilisateur...">
            </div>
        </div>
        
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Email</th>
                        <th>Téléphone</th>
                        <th>Région</th>
                        <th>Zone</th>
                        <th>Rôle</th>
                        <th>Date inscription</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <!-- Rempli dynamiquement -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- Scripts (chargés dans l'ordre) -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/vendors.js"></script>
    <script src="js/stock.js"></script>
    <script src="js/subsidies.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/logistics.js"></script>
    <script src="js/training.js"></script>
    <script src="js/users.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/main.js"></script>
</body>
</html>

